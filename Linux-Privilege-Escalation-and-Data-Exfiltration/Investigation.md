## Investigation

Following the NIST 800-61 framework, the investigation started with the incident created after it was detected by the scheduled rule that was part of the preparation phase 

## Preparation
### How Scheduled Rules Fit into the Preparation Phase

Under the **Preparation** phase, NIST SP 800-61 explicitly emphasises:

- Establishing detection and analysis capabilities  
- Deploying monitoring and logging mechanisms  
- Ensuring the organization can identify incidents quickly  

Creating **scheduled rules in a SIEM** (e.g., **Microsoft Sentinel**, **Splunk**) is an implementation of these requirements, enabling proactive detection and readiness before incidents occur

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr24.png)

Select the MITRE ATT&CK categories

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr25.png)

Set the query logic

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr26.png)


## Detection & Analysis


## Detection and Analysis Phase

The **Detection and Analysis** phase focuses on identifying potential security incidents and determining their scope, impact, and severity. This phase begins when an alert, event, or report indicates suspicious or malicious activity.

During this phase, organizations:

- Monitor security alerts generated by SIEM, EDR/XDR, IDS/IPS, and other security tools  
- Analyze logs, telemetry, and contextual data to confirm whether an event is a true incident  
- Classify incidents based on predefined categories and severity levels  
- Determine the affected systems, users, and data  
- Correlate indicators of compromise (IOCs) with threat intelligence sources  
- Document findings and maintain timelines for incident tracking  

Effective detection and analysis enable rapid decision-making, minimize false positives, and ensure that confirmed incidents are escalated promptly to the **Containment, Eradication, and Recovery** phase.



Using the scheduled rule using fewer hours 

```
DeviceProcessEvents
| where DeviceName contains "MM-Priv"
| where Timestamp > ago(6h)
| where InitiatingProcessCommandLine contains "usermod -aG"
| where InitiatingProcessCommandLine contains "sudo"
| project Timestamp, FileName, ProcessCommandLine, AccountName, InitiatingProcessAccountName

```

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr13.png)


Another query showed the user created

```
DeviceProcessEvents
| where DeviceName contains "MM-Priv"
| where Timestamp > ago(6h)
| where InitiatingProcessCommandLine contains "useradd"
| where InitiatingProcessCommandLine contains "sudo"
| project Timestamp, FileName, ProcessCommandLine, AccountName, InitiatingProcessAccountName

```

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr12.png)

Further query for analysis

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr14.png)


![image alt](https://github.com/Muts256/SNC-Public/blob/94094b1615b895bf31c4717583f2e489526564a0/Images/Linux-Privilege-Escalation/Pr27.png)

files created

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr15.png)


Check for any remote connection

![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr10.png)


![image alt](https://github.com/Muts256/SNC-Public/blob/aa6eef18578980df6f00d33a7ecb249daa32afd0/Images/Linux-Privilege-Escalation/Pr11.png)


